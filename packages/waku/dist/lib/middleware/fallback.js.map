{"version":3,"sources":["../../../src/lib/middleware/fallback.ts"],"sourcesContent":["import { resolveConfigDev } from '../config.js';\nimport { stringToStream } from '../utils/stream.js';\nimport type { Middleware } from './types.js';\n\nexport const fallback: Middleware = (options) => {\n  if (options.cmd === 'dev') {\n    const configPromise = resolveConfigDev(options.config);\n    return async (ctx, next) => {\n      if (!ctx.res.body) {\n        const config = await configPromise;\n        const newUrl = new URL(config.basePath, ctx.req.url);\n        ctx.req.url.pathname = newUrl.pathname;\n      }\n      return next();\n    };\n  }\n\n  const entriesPromise = options.loadEntries();\n  return async (ctx, _next) => {\n    const entries = await entriesPromise;\n    ctx.res.body = stringToStream(entries.publicIndexHtml);\n    ctx.res.headers = {\n      ...ctx.res.headers,\n      'content-type': 'text/html; charset=utf-8',\n    };\n  };\n};\n"],"names":["resolveConfigDev","stringToStream","fallback","options","cmd","configPromise","config","ctx","next","res","body","newUrl","URL","basePath","req","url","pathname","entriesPromise","loadEntries","_next","entries","publicIndexHtml","headers"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,eAAe;AAChD,SAASC,cAAc,QAAQ,qBAAqB;AAGpD,OAAO,MAAMC,WAAuB,CAACC;IACnC,IAAIA,QAAQC,GAAG,KAAK,OAAO;QACzB,MAAMC,gBAAgBL,iBAAiBG,QAAQG,MAAM;QACrD,OAAO,OAAOC,KAAKC;YACjB,IAAI,CAACD,IAAIE,GAAG,CAACC,IAAI,EAAE;gBACjB,MAAMJ,SAAS,MAAMD;gBACrB,MAAMM,SAAS,IAAIC,IAAIN,OAAOO,QAAQ,EAAEN,IAAIO,GAAG,CAACC,GAAG;gBACnDR,IAAIO,GAAG,CAACC,GAAG,CAACC,QAAQ,GAAGL,OAAOK,QAAQ;YACxC;YACA,OAAOR;QACT;IACF;IAEA,MAAMS,iBAAiBd,QAAQe,WAAW;IAC1C,OAAO,OAAOX,KAAKY;QACjB,MAAMC,UAAU,MAAMH;QACtBV,IAAIE,GAAG,CAACC,IAAI,GAAGT,eAAemB,QAAQC,eAAe;QACrDd,IAAIE,GAAG,CAACa,OAAO,GAAG;YAChB,GAAGf,IAAIE,GAAG,CAACa,OAAO;YAClB,gBAAgB;QAClB;IACF;AACF,EAAE"}