{"version":3,"sources":["../../../src/lib/builder/platform-data.ts"],"sourcesContent":["import { INTERNAL_iterateSerializablePlatformData } from '../../server.js';\nimport { joinPath } from '../utils/path.js';\nimport { mkdir, readFile, writeFile } from '../utils/node-fs.js';\nimport { DIST_ENTRIES_JS } from './constants.js';\n\nconst DIST_PLATFORM_DATA = 'platform-data';\n\nexport const emitPlatformData = async (distDir: string) => {\n  const keys = new Set<string>();\n  await mkdir(joinPath(distDir, DIST_PLATFORM_DATA), {\n    recursive: true,\n  });\n  for (const [key, data] of INTERNAL_iterateSerializablePlatformData()) {\n    keys.add(key);\n    const destFile = joinPath(distDir, DIST_PLATFORM_DATA, key + '.js');\n    await writeFile(destFile, `export default ${JSON.stringify(data)};`);\n  }\n  const distEntriesFile = joinPath(distDir, DIST_ENTRIES_JS);\n  let distEntriesFileContent = await readFile(distEntriesFile, {\n    encoding: 'utf8',\n  });\n  distEntriesFileContent = distEntriesFileContent.replace(\n    'globalThis.__WAKU_LOAD_PLATFORM_DATA__',\n    `\n(key) => {\n  switch (key) {\n    ${Array.from(keys)\n      .map(\n        (k) =>\n          `case '${k}': return import('./${DIST_PLATFORM_DATA}/${k}.js').then((m) => m.default);`,\n      )\n      .join('\\n')}\n    default: throw new Error('Cannot find platform data: ' + key);\n  }\n}\n`,\n  );\n  await writeFile(distEntriesFile, distEntriesFileContent);\n};\n"],"names":["INTERNAL_iterateSerializablePlatformData","joinPath","mkdir","readFile","writeFile","DIST_ENTRIES_JS","DIST_PLATFORM_DATA","emitPlatformData","distDir","keys","Set","recursive","key","data","add","destFile","JSON","stringify","distEntriesFile","distEntriesFileContent","encoding","replace","Array","from","map","k","join"],"mappings":"AAAA,SAASA,wCAAwC,QAAQ,kBAAkB;AAC3E,SAASC,QAAQ,QAAQ,mBAAmB;AAC5C,SAASC,KAAK,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,sBAAsB;AACjE,SAASC,eAAe,QAAQ,iBAAiB;AAEjD,MAAMC,qBAAqB;AAE3B,OAAO,MAAMC,mBAAmB,OAAOC;IACrC,MAAMC,OAAO,IAAIC;IACjB,MAAMR,MAAMD,SAASO,SAASF,qBAAqB;QACjDK,WAAW;IACb;IACA,KAAK,MAAM,CAACC,KAAKC,KAAK,IAAIb,2CAA4C;QACpES,KAAKK,GAAG,CAACF;QACT,MAAMG,WAAWd,SAASO,SAASF,oBAAoBM,MAAM;QAC7D,MAAMR,UAAUW,UAAU,CAAC,eAAe,EAAEC,KAAKC,SAAS,CAACJ,MAAM,CAAC,CAAC;IACrE;IACA,MAAMK,kBAAkBjB,SAASO,SAASH;IAC1C,IAAIc,yBAAyB,MAAMhB,SAASe,iBAAiB;QAC3DE,UAAU;IACZ;IACAD,yBAAyBA,uBAAuBE,OAAO,CACrD,0CACA,CAAC;;;IAGD,EAAEC,MAAMC,IAAI,CAACd,MACVe,GAAG,CACF,CAACC,IACC,CAAC,MAAM,EAAEA,EAAE,oBAAoB,EAAEnB,mBAAmB,CAAC,EAAEmB,EAAE,6BAA6B,CAAC,EAE1FC,IAAI,CAAC,MAAM;;;;AAIlB,CAAC;IAEC,MAAMtB,UAAUc,iBAAiBC;AACnC,EAAE"}