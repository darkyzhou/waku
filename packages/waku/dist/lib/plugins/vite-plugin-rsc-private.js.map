{"version":3,"sources":["../../../src/lib/plugins/vite-plugin-rsc-private.ts"],"sourcesContent":["import type { Plugin } from 'vite';\n\nimport { joinPath } from '../utils/path.js';\nimport type { HotUpdatePayload } from './vite-plugin-rsc-hmr.js';\n\nexport function rscPrivatePlugin({\n  privateDir,\n  hotUpdateCallback,\n}: {\n  privateDir: string;\n  hotUpdateCallback?: (payload: HotUpdatePayload) => void;\n}): Plugin {\n  let privatePath: string;\n  return {\n    name: 'rsc-private-plugin',\n    configResolved(config) {\n      privatePath = joinPath(config.root, privateDir);\n    },\n    load(id) {\n      if (id.startsWith(privatePath)) {\n        throw new Error('Private file access is not allowed');\n      }\n    },\n    handleHotUpdate({ file }) {\n      if (file.startsWith(privatePath)) {\n        hotUpdateCallback?.({ type: 'custom', event: 'rsc-reload' });\n      }\n    },\n  };\n}\n"],"names":["joinPath","rscPrivatePlugin","privateDir","hotUpdateCallback","privatePath","name","configResolved","config","root","load","id","startsWith","Error","handleHotUpdate","file","type","event"],"mappings":"AAEA,SAASA,QAAQ,QAAQ,mBAAmB;AAG5C,OAAO,SAASC,iBAAiB,EAC/BC,UAAU,EACVC,iBAAiB,EAIlB;IACC,IAAIC;IACJ,OAAO;QACLC,MAAM;QACNC,gBAAeC,MAAM;YACnBH,cAAcJ,SAASO,OAAOC,IAAI,EAAEN;QACtC;QACAO,MAAKC,EAAE;YACL,IAAIA,GAAGC,UAAU,CAACP,cAAc;gBAC9B,MAAM,IAAIQ,MAAM;YAClB;QACF;QACAC,iBAAgB,EAAEC,IAAI,EAAE;YACtB,IAAIA,KAAKH,UAAU,CAACP,cAAc;gBAChCD,oBAAoB;oBAAEY,MAAM;oBAAUC,OAAO;gBAAa;YAC5D;QACF;IACF;AACF"}