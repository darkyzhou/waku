{"version":3,"sources":["../../../src/lib/plugins/vite-plugin-rsc-env.ts"],"sourcesContent":["import type { Plugin } from 'vite';\nimport * as dotenv from 'dotenv';\n\nexport function rscEnvPlugin({\n  isDev,\n  env,\n  config,\n}: {\n  isDev: boolean;\n  env: Record<string, string>;\n  config?: {\n    basePath: string;\n    rscBase: string;\n  };\n}): Plugin {\n  return {\n    name: 'rsc-env-plugin',\n    config(viteConfig) {\n      if (isDev) {\n        dotenv.config({\n          path: ['.env.local', '.env'],\n          processEnv: env,\n          override: true,\n        });\n      }\n\n      viteConfig.define = {\n        ...viteConfig.define,\n        ...Object.fromEntries([\n          ...(config\n            ? [\n                [\n                  'import.meta.env.WAKU_CONFIG_BASE_PATH',\n                  JSON.stringify(config.basePath),\n                ],\n                [\n                  'import.meta.env.WAKU_CONFIG_RSC_BASE',\n                  JSON.stringify(config.rscBase),\n                ],\n              ]\n            : []),\n          ...Object.entries(env).flatMap(([k, v]) =>\n            k.startsWith('WAKU_PUBLIC_')\n              ? [[`import.meta.env.${k}`, JSON.stringify(v)]]\n              : [],\n          ),\n          // Node style `process.env` for traditional compatibility\n          ...Object.entries(env).flatMap(([k, v]) =>\n            k.startsWith('WAKU_PUBLIC_')\n              ? [[`process.env.${k}`, JSON.stringify(v)]]\n              : [],\n          ),\n        ]),\n      };\n    },\n  };\n}\n"],"names":["dotenv","rscEnvPlugin","isDev","env","config","name","viteConfig","path","processEnv","override","define","Object","fromEntries","JSON","stringify","basePath","rscBase","entries","flatMap","k","v","startsWith"],"mappings":"AACA,YAAYA,YAAY,SAAS;AAEjC,OAAO,SAASC,aAAa,EAC3BC,KAAK,EACLC,GAAG,EACHC,MAAM,EAQP;IACC,OAAO;QACLC,MAAM;QACND,QAAOE,UAAU;YACf,IAAIJ,OAAO;gBACTF,OAAOI,MAAM,CAAC;oBACZG,MAAM;wBAAC;wBAAc;qBAAO;oBAC5BC,YAAYL;oBACZM,UAAU;gBACZ;YACF;YAEAH,WAAWI,MAAM,GAAG;gBAClB,GAAGJ,WAAWI,MAAM;gBACpB,GAAGC,OAAOC,WAAW,CAAC;uBAChBR,SACA;wBACE;4BACE;4BACAS,KAAKC,SAAS,CAACV,OAAOW,QAAQ;yBAC/B;wBACD;4BACE;4BACAF,KAAKC,SAAS,CAACV,OAAOY,OAAO;yBAC9B;qBACF,GACD,EAAE;uBACHL,OAAOM,OAAO,CAACd,KAAKe,OAAO,CAAC,CAAC,CAACC,GAAGC,EAAE,GACpCD,EAAEE,UAAU,CAAC,kBACT;4BAAC;gCAAC,CAAC,gBAAgB,EAAEF,GAAG;gCAAEN,KAAKC,SAAS,CAACM;6BAAG;yBAAC,GAC7C,EAAE;oBAER,yDAAyD;uBACtDT,OAAOM,OAAO,CAACd,KAAKe,OAAO,CAAC,CAAC,CAACC,GAAGC,EAAE,GACpCD,EAAEE,UAAU,CAAC,kBACT;4BAAC;gCAAC,CAAC,YAAY,EAAEF,GAAG;gCAAEN,KAAKC,SAAS,CAACM;6BAAG;yBAAC,GACzC,EAAE;iBAET,CAAC;YACJ;QACF;IACF;AACF"}