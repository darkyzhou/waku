{"version":3,"sources":["../../../src/lib/utils/vite-config.ts"],"sourcesContent":["import { mergeConfig } from 'vite';\nimport type { UserConfig } from 'vite';\n\nimport type { ConfigDev } from '../config.js';\n\nconst areProbablySamePlugins = (a: unknown, b: unknown): boolean => {\n  if (typeof a !== 'object' || a === null) {\n    return false;\n  }\n  if (typeof b !== 'object' || b === null) {\n    return false;\n  }\n  if (Array.isArray(a) && Array.isArray(b)) {\n    return (\n      a.length === b.length &&\n      a.every((item, index) => areProbablySamePlugins(item, b[index]))\n    );\n  }\n  return 'name' in a && 'name' in b && a.name === b.name;\n};\n\nexport const extendViteConfig = (\n  viteConfig: UserConfig,\n  configDev: ConfigDev,\n  key: Exclude<keyof NonNullable<ConfigDev['unstable_viteConfigs']>, 'common'>,\n) => {\n  const mergedConfig = mergeConfig(viteConfig, {\n    // shallow merge\n    ...configDev.unstable_viteConfigs?.['common']?.(),\n    ...configDev.unstable_viteConfigs?.[key]?.(),\n  });\n  // remove duplicate plugins (latter wins)\n  mergedConfig.plugins = (mergedConfig as UserConfig).plugins?.filter(\n    (plugin, index, arr) =>\n      arr.findLastIndex((p) => areProbablySamePlugins(p, plugin)) === index,\n  );\n  return mergedConfig;\n};\n"],"names":["mergeConfig","areProbablySamePlugins","a","b","Array","isArray","length","every","item","index","name","extendViteConfig","viteConfig","configDev","key","mergedConfig","unstable_viteConfigs","plugins","filter","plugin","arr","findLastIndex","p"],"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AAKnC,MAAMC,yBAAyB,CAACC,GAAYC;IAC1C,IAAI,OAAOD,MAAM,YAAYA,MAAM,MAAM;QACvC,OAAO;IACT;IACA,IAAI,OAAOC,MAAM,YAAYA,MAAM,MAAM;QACvC,OAAO;IACT;IACA,IAAIC,MAAMC,OAAO,CAACH,MAAME,MAAMC,OAAO,CAACF,IAAI;QACxC,OACED,EAAEI,MAAM,KAAKH,EAAEG,MAAM,IACrBJ,EAAEK,KAAK,CAAC,CAACC,MAAMC,QAAUR,uBAAuBO,MAAML,CAAC,CAACM,MAAM;IAElE;IACA,OAAO,UAAUP,KAAK,UAAUC,KAAKD,EAAEQ,IAAI,KAAKP,EAAEO,IAAI;AACxD;AAEA,OAAO,MAAMC,mBAAmB,CAC9BC,YACAC,WACAC;IAEA,MAAMC,eAAef,YAAYY,YAAY;QAC3C,gBAAgB;QAChB,GAAGC,UAAUG,oBAAoB,EAAE,CAAC,SAAS,IAAI;QACjD,GAAGH,UAAUG,oBAAoB,EAAE,CAACF,IAAI,IAAI;IAC9C;IACA,yCAAyC;IACzCC,aAAaE,OAAO,GAAG,AAACF,aAA4BE,OAAO,EAAEC,OAC3D,CAACC,QAAQV,OAAOW,MACdA,IAAIC,aAAa,CAAC,CAACC,IAAMrB,uBAAuBqB,GAAGH,aAAaV;IAEpE,OAAOM;AACT,EAAE"}