{"version":3,"sources":["../../src/lib/types.ts"],"sourcesContent":["import type { ReactNode } from 'react';\n\nimport type { Config } from '../config.js';\nimport type { ConfigPrd } from '../lib/config.js';\nimport type { PathSpec } from '../lib/utils/path.js';\n\ntype Elements = Record<string, unknown>;\n\ntype RenderRsc<Opts = unknown> = (\n  elements: Record<string, unknown>,\n  options?: Opts,\n) => Promise<ReadableStream>;\n\ntype RenderHtml<Opts = unknown> = (\n  elements: Elements,\n  html: ReactNode,\n  options: { rscPath: string; actionResult?: unknown } & Opts,\n) => Promise<{\n  body: ReadableStream & { allReady: Promise<void> };\n  headers: Record<'content-type', string>;\n}>;\n\n// This API is still unstable\nexport type HandleRequest = (\n  input: (\n    | { type: 'component'; rscPath: string; rscParams: unknown }\n    | {\n        type: 'function';\n        fn: (...args: unknown[]) => Promise<unknown>;\n        args: unknown[];\n      }\n    | {\n        type: 'action';\n        fn: () => Promise<unknown>;\n        pathname: string;\n      }\n    | { type: 'custom'; pathname: string }\n  ) & {\n    req: HandlerReq;\n  },\n  utils: {\n    renderRsc: RenderRsc;\n    renderHtml: RenderHtml;\n  },\n) => Promise<ReadableStream | HandlerRes | null | undefined>;\n\n// needs better name (it's not just config)\ntype BuildConfig =\n  | {\n      type: 'file';\n      pathname: string;\n      body: Promise<ReadableStream>;\n    }\n  | {\n      type: 'htmlHead';\n      pathSpec: PathSpec;\n      head?: string;\n    }\n  | {\n      type: 'defaultHtml';\n      pathname: string;\n      head?: string;\n    };\n\n// This API is still unstable\nexport type HandleBuild = (utils: {\n  renderRsc: RenderRsc<{ moduleIdCallback?: (id: string) => void }>;\n  renderHtml: RenderHtml<{ htmlHead?: string }>;\n  rscPath2pathname: (rscPath: string) => string;\n  unstable_generatePrefetchCode: (\n    rscPaths: Iterable<string>,\n    moduleIds: Iterable<string>,\n  ) => string;\n  unstable_collectClientModules: (elements: Elements) => Promise<string[]>;\n}) => AsyncIterable<BuildConfig> | null;\n\nexport type EntriesDev = {\n  default: {\n    handleRequest: HandleRequest;\n    handleBuild: HandleBuild;\n  };\n};\n\nexport type EntriesPrd = EntriesDev & {\n  // TODO eliminate loadConfig\n  loadConfig: () => Promise<Config>;\n  configPrd: ConfigPrd;\n  loadModule: (id: string) => Promise<unknown>;\n  dynamicHtmlPaths: [pathSpec: PathSpec, htmlHead: string][];\n  publicIndexHtml: string;\n  loadPlatformData?: (key: string) => Promise<unknown>;\n};\n\nexport type HandlerReq = {\n  body: ReadableStream | null;\n  url: URL;\n  method: string;\n  headers: Readonly<Record<string, string>>;\n};\n\nexport type HandlerRes = {\n  body?: ReadableStream;\n  headers?: Record<string, string | string[]>;\n  status?: number;\n};\n"],"names":[],"mappings":"AAoGA,WAIE"}